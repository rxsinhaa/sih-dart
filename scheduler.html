<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dart Institute of Technology - Timetable Planner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .timetable-grid { display: grid; grid-template-columns: 100px repeat(4, 1fr); grid-template-rows: 40px repeat(5, 1fr); gap: 4px; }
        .grid-header { font-weight: 600; display: flex; align-items: center; justify-content: center; background-color: #f3f4f6; border-radius: 0.375rem; padding: 0.5rem; }
        .grid-cell { 
            border-radius: 0.375rem; padding: 0.75rem; min-height: 80px; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center; background-color: #ffffff; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid transparent;
        }
        .grid-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10;
        }
        .tutorial-slot {
            background-color: #ffffff !important; 
            border: 2px solid #312e81;
            color: #1e1b4b; 
        }
        .tutorial-slot .teacher-name {
            color: #312e81;
        }
        .day-label { font-weight: 600; display: flex; align-items: center; justify-content: center; }
        .subject-name { font-weight: 600; font-size: 0.875rem; }
        .teacher-name { font-size: 0.75rem; color: #4b5563; }
        .tab-button { transition: background-color 0.3s, color 0.3s; }
        .tab-button.active { background-color: #4f46e5; color: white; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .timetable-option { transition: all 0.3s ease-in-out; border: 2px solid transparent; }
        .timetable-option:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        .timetable-option.selected {
            border-color: #4f46e5;
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2), 0 4px 6px -2px rgba(79, 70, 229, 0.1);
            transform: scale(1.02) translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3">
                    <svg class="h-8 w-8 text-indigo-600" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                        <path stroke="none" d="M0 0h24v24H0z"/> <path d="M3 12h2l2 -9l2 18l2 -9l2 9l2 -18l2 9h2" />
                    </svg>
                    <span class="font-bold text-xl text-indigo-600">Dart Institute of Technology</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" id="home-btn" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Home</a>
                        <a href="#" id="my-schedules-btn" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">My Schedules</a>
                        <a href="#" id="help-btn" class="text-gray-500 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">Help</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-8">
        
        <div id="initial-view">
            <div class="text-center pt-16 sm:pt-24 pb-12">
                <h1 class="text-4xl md:text-6xl font-extrabold text-gray-900 tracking-tight">
                    The Future of Academic Scheduling
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-lg text-gray-500">
                    The gold standard in academic scheduling. Our powerful algorithm delivers optimized, clash-free timetables in seconds.
                </p>
                <div class="mt-8 flex justify-center">
                    <button id="generate-btn" class="inline-flex items-center bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition-transform transform hover:scale-105">
                        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Generate Timetable Options
                    </button>
                </div>
            </div>
            
            <div class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-extrabold text-gray-800">How It Works</h2>
                    <p class="mt-2 text-md text-gray-500">Our scheduler uses a constraint satisfaction algorithm to find the best fit.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="p-6 bg-white rounded-xl shadow-md">
                        <div class="text-5xl text-indigo-500 font-black">1</div>
                        <h3 class="mt-4 text-lg font-bold">Define Constraints</h3>
                        <p class="mt-1 text-sm text-gray-600">We gather all rules: teacher availability, weekly class quotas, daily limits, and more.</p>
                    </div>
                    <div class="p-6 bg-white rounded-xl shadow-md">
                        <div class="text-5xl text-indigo-500 font-black">2</div>
                        <h3 class="mt-4 text-lg font-bold">Randomized Iteration</h3>
                        <p class="mt-1 text-sm text-gray-600">The algorithm shuffles all possible class slots and attempts to place teachers one by one.</p>
                    </div>
                    <div class="p-6 bg-white rounded-xl shadow-md">
                        <div class="text-5xl text-indigo-500 font-black">3</div>
                        <h3 class="mt-4 text-lg font-bold">Validate & Repeat</h3>
                        <p class="mt-1 text-sm text-gray-600">If a placement breaks any rule, the attempt is discarded. This repeats until a valid, clash-free schedule is found.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="loader-container" class="hidden text-center my-8">
            <div class="loader inline-block"></div>
            <p class="mt-2 text-gray-600">Generating optimal schedules...</p>
        </div>
        <div id="output-container" class="space-y-12"></div>
    </main>
    
    <footer class="bg-white mt-auto">
        <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500">
            <p>&copy; 2025 Dart Institute of Technology. All rights reserved.</p>
        </div>
    </footer>

    <div id="help-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-2xl p-6 sm:p-8 w-full max-w-md transform transition-all" id="help-modal-content"></div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        const config = { teachers: [{ name: 'Arindam', subject: 'Elec. Eng.', unavailable: [] }, { name: 'Leesha', subject: 'Mathematics', unavailable: [{ day: 'Tuesday', slot: '10am - 12pm' }] }, { name: 'Devanshu', subject: 'Physics', unavailable: [] }, { name: 'Tanmay', subject: 'Comp. Sci.', unavailable: [{ day: 'Friday', slot: '3pm - 5pm' }] }], branches: ['ECE', 'CS', 'IT'], days: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'], timeSlots: ['8am - 10am', '10am - 12pm', '1pm - 3pm', '3pm - 5pm'], constraints: { maxDailySlotsPerTeacher: 3, weeklySlotsPerSubject: 5, maxDailySlotsPerSubjectForBranch: 2, }, subjectColors: { 'Elec. Eng.': 'bg-blue-100', 'Mathematics': 'bg-green-100', 'Physics': 'bg-yellow-100', 'Comp. Sci.': 'bg-purple-100' } };

        let generatedOptions = [];
        const generateBtn = document.getElementById('generate-btn');
        const outputContainer = document.getElementById('output-container');
        const loaderContainer = document.getElementById('loader-container');
        const initialView = document.getElementById('initial-view');
        const homeBtn = document.getElementById('home-btn');
        const mySchedulesBtn = document.getElementById('my-schedules-btn');
        const helpBtn = document.getElementById('help-btn');
        const helpModal = document.getElementById('help-modal');
        const modalFormHTML = `<div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-gray-800">Contact Support</h3><button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">&times;</button></div><form id="help-form"><div class="space-y-4"><div><label for="name" class="text-sm font-medium text-gray-700">Your Name</label><input type="text" id="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div><div><label for="email" class="text-sm font-medium text-gray-700">Your Email</label><input type="email" id="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></div><div><label for="message" class="text-sm font-medium text-gray-700">Your Message</label><textarea id="message" rows="4" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea></div></div><div class="mt-6"><button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Send Message</button></div></form>`;

        generateBtn.addEventListener('click', handleGenerateClick);
        homeBtn.addEventListener('click', showInitialView);
        mySchedulesBtn.addEventListener('click', showSavedSchedule);
        helpBtn.addEventListener('click', openHelpModal);
        helpModal.addEventListener('click', (e) => { if (e.target === helpModal) helpModal.classList.add('hidden'); });

        function handleGenerateClick() {
            showLoader();
            setTimeout(() => {
                generatedOptions = [];
                let attempts = 0;
                while (generatedOptions.length < 3 && attempts < 500) {
                    const schedule = generateSingleTimetable();
                    if (schedule && !generatedOptions.some(opt => JSON.stringify(opt) === JSON.stringify(schedule))) generatedOptions.push(schedule);
                    attempts++;
                }
                hideLoader();
                if (generatedOptions.length === 0) outputContainer.innerHTML = `<div class="text-center text-red-600 bg-red-100 p-4 rounded-lg">Failed to generate timetables. Constraints may be too strict.</div>`;
                else renderAllOptions(generatedOptions, "Option");
            }, 50);
        }

        function showSavedSchedule(e) {
            e.preventDefault();
            const savedData = localStorage.getItem('savedTimetable');
            if (savedData) {
                const savedSchedule = JSON.parse(savedData);
                hideAllViews();
                renderAllOptions([savedSchedule], "Your Saved Schedule", true);
            } else {
                alert('You have not saved a schedule yet. Please generate and select a schedule first.');
            }
        }

        function openHelpModal() {
            document.getElementById('help-modal-content').innerHTML = modalFormHTML;
            helpModal.classList.remove('hidden');
            document.getElementById('close-modal-btn').addEventListener('click', () => helpModal.classList.add('hidden'));
            document.getElementById('help-form').addEventListener('submit', handleHelpFormSubmit);
        }
        
        function handleHelpFormSubmit(e) {
            e.preventDefault();
            const modalContent = document.getElementById('help-modal-content');
            modalContent.innerHTML = `<div class="text-center p-8"><h3 class="text-xl font-bold text-green-600">Thank You!</h3><p class="text-gray-600 mt-2">Your message has been received.</p></div>`;
            setTimeout(() => helpModal.classList.add('hidden'), 2500);
        }

        function hideAllViews() { initialView.classList.add('hidden'); loaderContainer.classList.add('hidden'); outputContainer.innerHTML = ''; }
        function showInitialView(e) { if (e) e.preventDefault(); hideAllViews(); initialView.classList.remove('hidden'); }
        function showLoader() { hideAllViews(); loaderContainer.classList.remove('hidden'); }
        function hideLoader() { loaderContainer.classList.add('hidden'); }

        function generateSingleTimetable() {
            let attempt = 0;
            while (attempt < 100) {
                let schedule = tryToGenerate();
                if (schedule) {
                    return assignTutorials(schedule);
                }
                attempt++;
            }
            return null;
        }

        function assignTutorials(schedule) {
            const { branches, constraints } = config;
            const weeklySlotsPerSubject = constraints.weeklySlotsPerSubject;
            for (const branch of branches) {
                const subjectsInBranch = {};
                for (const day of Object.values(schedule)) {
                    for (const slot of Object.values(day)) {
                        if (slot[branch]) {
                            const classInfo = slot[branch];
                            if (!subjectsInBranch[classInfo.subject]) {
                                subjectsInBranch[classInfo.subject] = [];
                            }
                            subjectsInBranch[classInfo.subject].push(classInfo);
                        }
                    }
                }
                for (const subject in subjectsInBranch) {
                    if (subjectsInBranch[subject].length === weeklySlotsPerSubject) {
                        const randomIndex = Math.floor(Math.random() * subjectsInBranch[subject].length);
                        subjectsInBranch[subject][randomIndex].isTutorial = true;
                    }
                }
            }
            return schedule;
        }

        function tryToGenerate() { const { teachers, branches, days, timeSlots, constraints } = config; const schedule = Object.fromEntries(days.map(d => [d, Object.fromEntries(timeSlots.map(t => [t, {}]))])); const weeklySlots = Object.fromEntries(branches.map(b => [b, Object.fromEntries(teachers.map(t => [t.subject, 0]))])); const dailySlots = Object.fromEntries(teachers.map(t => [t.name, Object.fromEntries(days.map(d => [d, 0]))])); const dailySubjectSlots = Object.fromEntries(branches.map(b => [b, Object.fromEntries(days.map(d => [d, {}]))])); for (const day of days) { for (const slot of timeSlots) { const teachersInThisSlot = new Set(); for (const branch of branches) { const shuffledTeachers = [...teachers].sort(() => Math.random() - 0.5); let assigned = false; for (const teacher of shuffledTeachers) { const subject = teacher.subject; if (!dailySubjectSlots[branch][day][subject]) dailySubjectSlots[branch][day][subject] = 0; const isTeacherDoubleBooked = teachersInThisSlot.has(teacher.name); const hasTeacherReachedDailyLimit = dailySlots[teacher.name][day] >= constraints.maxDailySlotsPerTeacher; const hasBranchMetWeeklyQuota = weeklySlots[branch][subject] >= constraints.weeklySlotsPerSubject; const isTeacherUnavailable = teacher.unavailable.some(u => u.day === day && u.slot === slot); const hasBranchExceededDailySubjectLimit = dailySubjectSlots[branch][day][subject] >= constraints.maxDailySlotsPerSubjectForBranch; if (!isTeacherDoubleBooked && !hasTeacherReachedDailyLimit && !hasBranchMetWeeklyQuota && !isTeacherUnavailable && !hasBranchExceededDailySubjectLimit) { schedule[day][slot][branch] = { teacher: teacher.name, subject: subject }; dailySlots[teacher.name][day]++; weeklySlots[branch][subject]++; dailySubjectSlots[branch][day][subject]++; teachersInThisSlot.add(teacher.name); assigned = true; break; } } if (!assigned) return null; } } } return schedule; }
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } }

        function renderAllOptions(options, titlePrefix, isSavedView = false) {
            outputContainer.innerHTML = '';
            options.forEach((schedule, index) => {
                const optionId = `option-${index}`;
                const optionElement = document.createElement('div');
                optionElement.className = 'timetable-option bg-white p-6 rounded-xl shadow-lg';
                optionElement.id = optionId;
                
                let buttonsHTML = '';
                if (isSavedView) {
                    buttonsHTML = `<button class="clear-schedule-btn bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition">Clear Saved Schedule</button>
                                 <button class="download-btn bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-700 transition">Download PDF</button>`;
                } else {
                    buttonsHTML = `<button data-index="${index}" class="select-btn bg-indigo-100 text-indigo-700 font-semibold py-2 px-4 rounded-lg hover:bg-indigo-200 transition">Select & Save</button>
                                 <button class="download-btn bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-700 transition">Download PDF</button>`;
                }

                optionElement.innerHTML = `<div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-indigo-700">${titlePrefix} ${options.length > 1 ? index + 1 : ''}</h2><div class="flex space-x-2">${buttonsHTML}</div></div><div class="border-b border-gray-200 mb-4"><nav class="-mb-px flex space-x-6" id="tabs-${optionId}"></nav></div><div class="timetable-content-wrapper" id="timetable-content-${optionId}"></div>`;
                outputContainer.appendChild(optionElement);
                const tabsContainer = optionElement.querySelector(`#tabs-${optionId}`);
                config.branches.forEach((branch, branchIndex) => { const button = document.createElement('button'); button.className = `tab-button whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm rounded-t-md ${branchIndex === 0 ? 'active' : ''}`; button.dataset.branch = branch; button.textContent = `${branch} Timetable`; button.addEventListener('click', (e) => { tabsContainer.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); renderTimetableForBranch(schedule, e.target.dataset.branch, optionId); }); tabsContainer.appendChild(button); });
                renderTimetableForBranch(schedule, config.branches[0], optionId);
            });

            if (isSavedView) {
                document.querySelector('.clear-schedule-btn')?.addEventListener('click', () => { if (confirm('Are you sure you want to delete your saved schedule?')) { localStorage.removeItem('savedTimetable'); alert('Schedule cleared!'); showInitialView(); } });
            } else {
                document.querySelectorAll('.select-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        document.querySelectorAll('.timetable-option').forEach(opt => opt.classList.remove('selected'));
                        const parentOption = e.target.closest('.timetable-option');
                        parentOption.classList.add('selected');
                        const selectedIndex = parseInt(e.target.dataset.index, 10);
                        const scheduleToSave = generatedOptions[selectedIndex];
                        localStorage.setItem('savedTimetable', JSON.stringify(scheduleToSave));
                        alert('Schedule saved successfully!');
                    });
                });
            }

            document.querySelectorAll('.download-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const parentOption = e.target.closest('.timetable-option'); const timetableContent = parentOption.querySelector('.timetable-content-wrapper'); const activeTab = parentOption.querySelector('.tab-button.active'); const branchName = activeTab ? activeTab.dataset.branch : 'Timetable'; const optionTitle = parentOption.querySelector('h2').textContent; const collegeName = "Dart Institute of Technology"; const academicYear = "Academic Year 2025-2026";
                    html2canvas(timetableContent).then(canvas => { const imgData = canvas.toDataURL('image/png'); const pdf = new jsPDF({ orientation: 'landscape', unit: 'mm' }); const pdfWidth = pdf.internal.pageSize.getWidth(); const pdfHeight = pdf.internal.pageSize.getHeight(); const margin = 15; pdf.setFontSize(20); pdf.text(collegeName, pdfWidth / 2, margin, { align: 'center' }); pdf.setFontSize(14); pdf.text(`${branchName} Department - ${academicYear}`, pdfWidth / 2, margin + 8, { align: 'center' }); const imgProps = pdf.getImageProperties(imgData); const imgHeight = (imgProps.height * (pdfWidth - margin * 2)) / imgProps.width; const yPos = margin + 15; pdf.addImage(imgData, 'PNG', margin, yPos, pdfWidth - margin * 2, imgHeight); const today = new Date().toLocaleDateString('en-GB'); pdf.setFontSize(10); pdf.text(`Generated on: ${today}`, pdfWidth / 2, pdfHeight - margin + 10, { align: 'center' }); pdf.save(`${optionTitle}-${branchName}.pdf`); });
                });
            });
        }
        
        function renderTimetableForBranch(schedule, branch, optionId) {
            const contentDiv = document.getElementById(`timetable-content-${optionId}`);
            const { days, timeSlots, subjectColors } = config;
            let gridHTML = '<div class="timetable-grid">';
            gridHTML += '<div></div>';
            timeSlots.forEach(slot => { gridHTML += `<div class="grid-header text-xs md:text-sm">${slot}</div>`; });
            days.forEach(day => {
                gridHTML += `<div class="day-label text-xs md:text-sm">${day}</div>`;
                timeSlots.forEach(slot => {
                    const classInfo = schedule[day][slot][branch];
                    if (classInfo) {
                        const colorClass = subjectColors[classInfo.subject] || 'bg-gray-100';
                        const tutorialClass = classInfo.isTutorial ? 'tutorial-slot' : '';
                        const tutorialLabel = classInfo.isTutorial ? ' (Lab)' : '';
                        gridHTML += `<div class="grid-cell ${colorClass} ${tutorialClass}">
                                        <span class="subject-name">${classInfo.subject}${tutorialLabel}</span>
                                        <span class="teacher-name">${classInfo.teacher}</span>
                                    </div>`;
                    } else {
                        gridHTML += '<div class="grid-cell bg-gray-50">--</div>';
                    }
                });
            });
            gridHTML += '</div>';
            contentDiv.innerHTML = gridHTML;
        }
    </script>
</body>
</html>